/**
 * Kissmetrics JS
 * https://github.com/evansolomon/kissmetrics-js
 * Copyright (c) 2013
 * Evan Solomon; Licensed MIT
 */

(function(){var t,e,r,n,i,o,s={}.hasOwnProperty,u=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i="undefined"!=typeof exports,i===!0&&(o=require("https")),r=function(){function t(t,e,r){var n;this.apiKey=t,this.person=e,null==r&&(r={}),this.queries=[],i===!0&&r.queue&&(n=require("./kissmetrics-batch"),this.batchClient=new n(r.queue))}return t.HOST="trk.kissmetrics.com",t.QUERY_TYPES={record:"e",set:"s",alias:"a"},t.prototype.record=function(t,e){return null==e&&(e={}),e._n=t,this._generateQuery("record",e)},t.prototype.set=function(t){return delete t._n,this._generateQuery("set",t)},t.prototype.alias=function(t){var e;return e=this._generateQuery("alias",{_n:t}),this.person=t,e},t.prototype._httpsRequest=function(t){var e;return e="https://"+t.host+"/"+(t.path||""),i===!0?o.get(e):(new Image).src=e},t.prototype._validateData=function(t){if(this.apiKey)t._k=this.apiKey;else if(!this.batchClient)throw Error("API key required");if(this.person)return t._p=this.person;throw Error("Person required")},t.prototype._generateQuery=function(e,r){var n,i,o,s,u,a,c;return this._validateData(r),this.batchClient?(n=r,n.__type=e,this.batchClient.add(n)):(s=function(){var t,e;e=[];for(i in r)c=r[i],t=function(){var t,e,r,n;for(r=[i,c],n=[],t=0,e=r.length;e>t;t++)o=r[t],n.push(encodeURIComponent(o));return n}(),i=t[0],c=t[1],e.push(""+i+"="+c);return e}(),u=s.join("&"),a=t.QUERY_TYPES[e],this.queries.push(this._httpsRequest({host:t.HOST,path:""+a+"?"+u}))),this},t}(),i===!0?module.exports=r:this.KissmetricsClient=r,n={get:function(){return window.localStorage.getItem(this.key)},set:function(t){return window.localStorage.setItem(this.key,t)},"delete":function(){return window.localStorage.removeItem(this.key)}},e={get:function(){var t,e,r,n,i;for(e=""+this.key+"=",i=document.cookie.split(/;\s*/),r=0,n=i.length;n>r;r++)if(t=i[r],0===t.indexOf(e))return t.substring(e.length)},set:function(t,e){var r;return null==e&&(e={expires:""}),e.expires||(r=new Date,r.setTime(r.getTime()+31536e6),e.expires="expires="+r.toGMTString()),document.cookie=""+this.key+"="+t+"; "+e.expires+"; path=/"},"delete":function(){return e.set(this.key,"",{expires:-1})}},t=function(t){function r(t,i){var o,s;null==i&&(i={}),null==(s=i.storage)&&(i.storage=null),this._storage=function(){if(!i.storage)return null!=window.localStorage?n:e;switch(i.storage){case"cookie":return e;case"localStorage":return n;default:return i.storage}}(),this._storage.key=i.storageKey||"kissmetricsAnon",(o=this._storage.get())||(o=this.createID(),this._storage.set(o)),r.__super__.constructor.call(this,t,o)}return u(r,t),r.prototype.createID=function(){var t,e;return t=function(){var t,r;for(r=[],e=t=0;10>=t;e=++t)r.push((0|65536*(1+Math.random())).toString(16).substring(1));return r}(),t.join("")},r.prototype.alias=function(t,e){return null==e&&(e=!0),e!==!1&&this._storage["delete"](),r.__super__.alias.call(this,t)},r}(r),i!==!0&&(this.AnonKissmetricsClient=t)}).call(this);
//@ sourceMappingURL=min/kissmetrics.min.map